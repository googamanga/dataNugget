
<!DOCTYPE html>
<html>
<head>
  <link rel="stylesheet" href="assets/styles/blackorwhite.css">

  <script src="assets/js/jquery-1.4.2.min.js"></script>
  <script src="assets/js/brain.js"></script>
  <script src="assets/js/handlebars.js"></script>
  <!--<script src="assets/js/blackorwhite.js"></script>-->

  <title>dataNugget</title>
</head>

<body>
  <h1>dataNugget</h1>
  <textarea id='inputData' rows='10' cols='90'></textarea>
  <button type='button' >Input Data</button>
  <div id="progress-bar">
  <div id="progress-completed">
  <script type="text/javascript">
    $('document').ready(function(){
      var App = function(){
        this.net = new brain.NeuralNetwork();

        this.csvData = undefined;

        this.inputData = undefined;

        this.csvToTable = function(){
          try{
            var lines = this.csvData.split("\n"), output = [];
            for(var i = 0; i < lines.length; i++)
                output.push("<tr><td>"
                            + lines[i].slice(0,-1).split(",").join("</td><td>")
                            + "</td></tr>");
            output = "<table>" + output.join("") + "</table>";
            $('body').append(output);
          } catch(err){
            cnosole.log("could not convert csv to table, try again, err:", err);
          }
        };

        this.trainer = {
          parameters: {
            iterations: 1000,
            errorThresh: 0.00004,
            callbackPeriod: 500 //num of iterations, not miliseconds!
          },

          trainNetwork : function(inputData) {
            if(window.Worker) {
              console.log('start with worker');
              var worker = new Worker("assets/js/training-worker.js");
              worker.onmessage = this.onMessage;
              worker.onerror = this.onError;
              var dataForWorker = [];
              dataForWorker.push(this.parameters);
              dataForWorker.push(inputData);
              worker.postMessage(JSON.stringify(dataForWorker));
              console.log('done with worker');
            } else {
              console.log("COULDN'T RUN WORKER, ALL IS LOST!")
            }
          },

          onMessage : function(event) {
            var workerData = JSON.parse(event.data);
            if(workerData.type == 'progress') {
              trainer.showProgress(workerData);
            }
            else if(workerData.type == 'result') {
              var net = new brain.NeuralNetwork().fromJSON(workerData.net);
              $("#progress-bar").hide();
              console.log('done!');
              var output = net.run([1, 1, 0.984]);
              $('body').append($('<p>output: ' + output + 'should be 0.368804632969139 <p>'))
              output = net.run([0.1, 0.333333333333333, 0.976]);
              $('body').append($('<p>output: ' + output + 'should be 0 <p>'))
              output = net.run([0.1, 0.333333333333333, 0.776]);
              $('body').append($('<p>output: ' + output + 'should be 0.0995055220336768 <p>'))
              output = net.run([0.6, 1, 0.632]);
              $('body').append($('<p>output: ' + output + 'should be 0.74934728286069 <p>'))
            }
          },

          onError : function(event) {
            $("#training-message").text("error training network: " + event.message);
          },

          showProgress : function(progress) {
            var completed = progress.iterations / this.parameters.iterations * 100;
            console.log('complete %:', Math.round(completed, 1), 'error:', progress.error);
            $("#progress-completed").css("width", completed + "%");
          },
        }
      }

      var app = new App;

      $('button').click(function(e){
        console.log("clicked!");
        console.log('val:', $('#inputData').val() );
        // debugger
        if( $('#inputData').val() ){
          app.csvData = $('#inputData').val();
          app.csvToTable();
          app.inputData
          app.trainer.trainNetwork();
        } else {
          console.log('inputData is empty');
        }
      });

    });
  </script>
</body>
</html>

<!-- test: http://www.scientific-consultants.com/nnbd.html -->
<!-- python -m SimpleHTTPServer -->